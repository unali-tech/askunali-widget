const defaultConfig={apiKey:"default",styles:{borderColor:null,borderRadius:null,questionBox:{backgroundColor:null,fontColor:null},answerBox:{backgroundColor:null,fontColor:null}}};function getConfig(){var e=window.askUnaliConfig||{};return{...defaultConfig,...e}}function updateApiKey(e){window.askUnaliConfig={...window.askUnaliConfig,apiKey:e},resetWidget()}function highlightText(n,e){return e.forEach(e=>{var t=new RegExp(`\\b${e}\\b`,"gi");n=n.replace(t,`<a href="#" class="askunali-ingredient-link" style="color: #3366CC;">${e}</a>`)}),n}function createElement(e,t,n){e=document.createElement(e);return t&&(e.className=t),n&&(e.innerHTML=n),e}function typeText(t,n,i,a=30){let o=0;!function e(){o<n.length?(t.innerHTML+=n.charAt(o),o++,setTimeout(e,a)):i&&i()}()}function appendElement(e,t){e.appendChild(t)}function removeElement(e){e.parentNode.removeChild(e)}function showElement(e){e.style.display="flex"}function hideElement(e){e.style.display="none"}function getTimestamp(){return Date.now()}function formatTime(e){return e.toFixed(2)+" ms"}async function fetchAnswer(e){var t=getConfig(),n="answer_"+e,i=localStorage.getItem(n);if(i)return console.log("Using cached answer"),JSON.parse(i);try{var a,o=await fetch("https://rag-api-e0qu.onrender.com/ask_question",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,api_key:t.apiKey})});if(o.ok)return a=await o.json(),localStorage.setItem(n,JSON.stringify(a)),a;throw new Error("HTTP error! status: "+o.status)}catch(e){throw console.error("Error in fetchAnswer:",e),e}}async function fetchSuggestedQuestions(e){try{var t=await fetch("https://xybo-itpz-j8ne.p7.xano.io/api:pfjomY_8/get_suggested_questions?widget_api_key="+e,{method:"GET",headers:{"Content-Type":"application/json"}});if(t.ok)return await t.json();throw new Error("HTTP error! status: "+t.status)}catch(e){throw console.error("Error in fetchSuggestedQuestions:",e),e}}function startLoadingAnimation(){const e=document.getElementById("askunali-question-output-icon");e.classList.add("animate-svg"),setTimeout(()=>{e.classList.add("rotate")},100)}function stopLoadingAnimation(){const e=document.getElementById("askunali-question-output-icon");e.classList.remove("rotate"),e.classList.remove("animate-svg"),setTimeout(()=>{e.querySelectorAll('g[class^="outer-donut-"] > g').forEach(e=>{e.style.transform="translate(0, 0)"})},0)}function typeText(n,i,a){let o="",s=0;!function e(){var t;s<i.length?(t=i.charAt(s),o+=t,n.innerHTML=o,s++,setTimeout(e,20)):a&&a()}()}function fadeIn(t,e,n){t.style.opacity=0,t.style.display="block";let i=0;const a=10/e;!function e(){i+=a,(t.style.opacity=i)<1?setTimeout(e,10):n()}()}async function initWidget(){var e=getConfig();const a=document.getElementById("askunali-question_input_div");var t=document.querySelector(".askunali-question-input-container");const g=document.getElementById("askunali-answer"),m=document.getElementById("askunali-sources"),f=document.getElementById("askunali-link"),h=document.getElementById("askunali-return-button"),y=document.getElementById("askunali-shopping-container"),x=document.getElementById("askunali-shopping-links"),n=document.getElementById("askunali-question-suggestions-container"),i=document.getElementById("askunali-clear-button-image");var o=document.getElementById("askunali-clear-button-container");let k="";a.addEventListener("input",function(){(0<a.textContent.trim().length?(a.classList.add("not-empty"),showElement):(a.classList.remove("not-empty"),hideElement))(i)}),a.addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),s())}),t.addEventListener("click",function(e){{var t,n;document.activeElement!==a&&(a.focus(),0<a.textContent.length)&&(t=document.createRange(),n=window.getSelection(),t.selectNodeContents(a),t.collapse(!1),n.removeAllRanges(),n.addRange(t))}}),a.addEventListener("mousedown",function(e){document.activeElement!==a&&(e.preventDefault(),a.focus())}),h.addEventListener("click",function(){g.innerHTML=k,hideElement(h),0<x.children.length&&showElement(y)}),n.addEventListener("click",function(e){e.target.classList.contains("askunali-question-suggestion")&&(e=e.target.textContent,a.textContent=e,a.classList.add("not-empty"),showElement(i),s())}),o.addEventListener("click",function(){a.textContent="",a.classList.remove("not-empty"),hideElement(i),a.focus()});try{displaySuggestedQuestions((await fetchSuggestedQuestions(e.apiKey)).suggested_questions)}catch(e){console.error("Error fetching suggested questions:",e)}function s(){var e=a.textContent.trim();if(""!==e){r(),startLoadingAnimation(),n.style.display="none";var t=document.querySelector(".askunali-question-output-container"),t=(t.style.border="1px solid var(--color-border)",t.style.borderBottom="none",document.querySelector(".askunali-question-output-container-bottom"));t.style.height="10px",t.style.border="1px solid var(--color-border)",t.style.borderTop="none";const i=getTimestamp();console.log("Start time:",i),fetchAnswer(e).then(e=>{var t=getTimestamp();console.log("End time:",t),console.log("Response time:",formatTime(t-i)),stopLoadingAnimation();{const n=(t=e).type,l=t.answer,d=t.ingredients_data,c=t.activities_data,u=t.shopping_data;if("enhanced"===n){var a=l,o=d,s=c,r=()=>{var i,a,e;i=d,a=c,0<i.length+a.length&&typeText(m,"Sources: ",()=>{{var e,t=a;let n=1;i.forEach(e=>{var t=createElement("a","askunali-sources-count",n.toString());t.href=e.paper_url,t.target="_blank",appendElement(m,t),n++}),t.forEach(e=>{var t=createElement("a","askunali-sources-count",n.toString());t.href=e.paper_url,t.target="_blank",appendElement(m,t),n++}),showElement(f)}showElement(m)}),(0<(e=u).activities.length||0<e.ingredients.length)&&(e.activities.forEach(e=>{var t=createElement("a","askunali-shopping-container-count",e.display_name);t.href=e.link,t.target="_blank",t.style.display="flex",appendElement(x,t)}),showElement(y)),g.addEventListener("click",e=>{var t=d,n=c;if(e.target.classList.contains("askunali-ingredient-link")){e.preventDefault();const i=e.target.textContent;e=[...t,...n].find(e=>e.ingredient_name===i||e.activity_name===i);e&&(g.innerHTML=e.paper_summary,showElement(h),hideElement(y))}})};const p=[...o.map(e=>e.ingredient_name),...s.map(e=>e.activity_name)];let n="",i=0;!function e(){var t;i<a.length?(t=a.charAt(i),n+=t,g.innerHTML=highlightText(n,p),i++,setTimeout(e,20)):(k=g.innerHTML,(t=document.querySelector(".askunali-question-output-container-bottom")).style.border="1px solid var(--color-border)",t.style.height="auto",r())}()}else typeText(g,l)}}).catch(e=>{console.error("Error:",e),stopLoadingAnimation(),g.textContent="Oops! Something went wrong. Please try again later."})}}function r(){g.innerHTML="",k="",hideElement(m),hideElement(f),hideElement(h),hideElement(y),x.innerHTML=""}}function displaySuggestedQuestions(e){const t=document.getElementById("askunali-question-suggestions-container");t.innerHTML="",e.forEach(e=>{e=createElement("div","askunali-question-suggestion",e);appendElement(t,e)})}function loadAnimationStyles(){var e=document.createElement("style");e.innerHTML=`
    #askunali-widget .askunali-question-input-area::before {
      content: attr(data-placeholder);
      display: block;
      color: rgba(19, 19, 19, 0.4);
    }

    #askunali-widget .askunali-question-input-area:focus::before {
      content: none;
    }

    #askunali-widget .askunali-question-input-area.not-empty::before {
      display: none;
    }

    :root {
      --donut-move-distance: 0.5px;
    }

    @keyframes moveDonut1 {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(var(--donut-move-distance), calc(-1 * var(--donut-move-distance)));
      }
    }

    @keyframes moveDonut2 {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(var(--donut-move-distance), var(--donut-move-distance));
      }
    }

    @keyframes moveDonut3 {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(calc(-1 * var(--donut-move-distance)), var(--donut-move-distance));
      }
    }

    @keyframes moveDonut4 {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(calc(-1 * var(--donut-move-distance)), calc(-1 * var(--donut-move-distance)));
      }
    }

    @keyframes rotateSVG {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    .animate-svg .outer-donut-1 > g {
      animation: moveDonut1 0.1s ease-in-out forwards;
    }

    .animate-svg .outer-donut-2 > g {
      animation: moveDonut2 0.1s ease-in-out forwards;
    }

    .animate-svg .outer-donut-3 > g {
      animation: moveDonut3 0.1s ease-in-out forwards;
    }

    .animate-svg .outer-donut-4 > g {
      animation: moveDonut4 0.1s ease-in-out forwards;
    }

    .animate-svg.rotate > g {
      animation: rotateSVG 3s linear infinite;
      transform-origin: center;
    }
  `,document.head.appendChild(e)}function init(){var e=getConfig(),e=(e.apiKey||(console.warn("No API key provided. Requests will be limited."),e.apiKey="default"),document.getElementById("askunali"));e&&(e.outerHTML='<style style="--color-background:#F9FBFF;--color-border:#D0DDE8;--color-primary:#004695;--color-secondary:#303840;--font-size-answer-box:15px;--font-size-question-box:16px;--font-size-sources:14px;--spacing-base:1rem;--widget-max-width:900px;--widget-width:100%">:root{--widget-width:100%;--widget-max-width:900px;--spacing-base:1rem;--color-primary:#004695;--color-secondary:#303840;--color-background:#F9FBFF;--color-border:#D0DDE8;--font-size-question-box:16px;--font-size-answer-box:15px;--font-size-sources:14px}#askunali-widget #askunali-clear-button-image.hidden{display:none}#askunali-widget{width:var(--widget-width);max-width:var(--widget-max-width);margin:0 auto;padding:calc(var(--spacing-base) * 2);color:var(--color-secondary)}#askunali-widget .askunali-question-input-container,#askunali-widget .askunali-question-output-container{position:relative;background-color:#fff}#askunali-widget .askunali-question-input-container{border:1px solid var(--color-border);border-radius:4px;cursor:text;display:flex;align-items:center;padding-left:55px;height:75px}#askunali-widget #askunali-clear-button-container{height:100%;width:75px;display:flex;justify-content:center;align-items:center;cursor:pointer}#askunali-widget .askunali-question-output-container{padding:var(--spacing-base) calc(var(--spacing-base) * 1.2);min-height:calc(1rem * 6);margin-top:calc(var(--spacing-base) * 1.5);background-color:#fff;border-radius:4px 4px 0 0;border-bottom:none;padding-left:55px;padding-top:0;border:none}#askunali-widget .askunali-question-output-container-bottom{background-color:#fff;border:1px solid var(--color-border);border-top:1px solid #e1eaf1;border-top:none;border-radius:0 0 4px 4px;position:relative;height:auto;padding-right:calc(var(--spacing-base) * 1.2);padding-left:55px;padding-top:0;padding-bottom:0;border:none}#askunali-widget #askunali-question-suggestions-container{display:flex;justify-content:left;gap:15px;flex-wrap:wrap}#askunali-widget .askunali-question-suggestion{background:#f9fbff;border:1px solid #d5e1ea;height:50px;border-radius:8px;display:flex;justify-content:center;align-items:center;padding:0 20px;cursor:pointer;max-width:80%}#askunali-widget .askunali-question-icon{position:absolute;top:50%;transform:translateY(-50%);left:15px;width:23px;height:23px}#askunali-widget #askunali-question-output-icon{position:absolute;top:30px;left:10.5px;width:32px;height:32px;transform:translateY(-50%)}#askunali-widget .askunali-question-input-area{width:100%;min-height:calc(1rem * 1.5);border:none;outline:0;resize:none;font-size:var(--font-size-question-box);line-height:1.5;color:inherit;background-color:transparent}#askunali-widget .askunali-question-input-area::placeholder{font-size:var(--font-size-question-box);color:rgba(19,19,19,.4)}#askunali-widget #askunali-answer{font-size:15px;line-height:22px;padding-top:20px}#askunali-widget #askunali-link,#askunali-widget #askunali-separator,#askunali-widget #askunali-sources{display:none}#askunali-widget #askunali-shopping-cart-description{font-size:15px;color:#303840;margin-left:10px;margin-right:5px;opacity:90%}#askunali-widget #askunali-sources{align-items:center;font-size:var(--font-size-sources);opacity:90%;margin:15px 0}#askunali-widget .askunali-sources-count{display:inline-flex;justify-content:center;align-items:center;width:calc(1rem * 1.2);height:calc(1rem * 1.2);margin-left:5px;border:1px solid #374151;border-radius:50%;color:#374151;font-size:14px;opacity:90%;text-decoration:none}#askunali-widget #askunali-link a{font-size:var(--font-size-sources);color:var(--color-secondary);text-decoration:underline;opacity:90%}#askunali-widget #askunali-return-button{display:flex;justify-content:center;align-items:center;display:none;background:#fbfbff;opacity:90%;border:.5px solid #d5e1ea;border-radius:4px;height:42px;width:100px;margin-top:20px;cursor:pointer}#askunali-widget .askunali-ingredient-link{color:#36c;text-decoration:none}#askunali-widget #askunali-shopping-container{display:none;flex-wrap:wrap;align-items:center;margin-top:calc(var(--spacing-base) * 1.5)}#askunali-widget #askunali-shopping-links{display:flex;margin-left:15px}#askunali-widget .askunali-shopping-container-count{display:flex;justify-content:center;align-items:center;background:#fbfbff;border:.5px solid #d5e1ea;border-radius:4px;height:40px;min-width:40px;padding:0 15px;color:#303840;text-decoration:none;opacity:90%}#askunali-widget #askunali-bottom-container{display:flex;justify-content:space-between;align-items:baseline}@media screen and (max-width:900px){:root{--widget-max-width:340px}}</style><div id="askunali-widget" class="askunali-content" style="--color-background:#F9FBFF;--color-border:#D0DDE8;--color-primary:#004695;--color-secondary:#303840;--font-size-answer-box:15px;--font-size-question-box:16px;--font-size-sources:14px;--spacing-base:1rem;--widget-max-width:900px;--widget-width:100%;color:var(--color-secondary);margin:0 auto;max-width:var(--widget-max-width);padding:calc(var(--spacing-base) * 2);width:var(--widget-width)"><div class="askunali-content-wrapper"><div class="askunali-question-input-container" style="align-items:center;background-color:#fff;border:1px solid var(--color-border);border-radius:4px;cursor:text;display:flex;height:75px;padding-left:55px;position:relative"><svg class="askunali-question-icon" width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg" style="height:23px;left:15px;position:absolute;top:50%;transform:translateY(-50%);width:23px"><circle cx="9.5" cy="9.5" r="8.5" fill="white" stroke="#004695" stroke-width="2"/><path d="M22 22L16 16" stroke="#004695" stroke-width="2" stroke-linecap="round"/></svg><div contenteditable="true" class="askunali-question-input-area" data-placeholder="Ask question here" id="askunali-question_input_div" style="background-color:transparent;border:none;color:inherit;font-size:var(--font-size-question-box);line-height:1.5;min-height:calc(1rem * 1.5);outline:0;resize:none;width:100%"></div><input type="hidden" id="askunali-question_input"><div id="askunali-clear-button-container" style="align-items:center;cursor:pointer;display:flex;height:100%;justify-content:center;width:75px"><svg id="askunali-clear-button-image" class="hidden" width="12" height="12" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:none"><path d="M2.07102 10.5369L0.664773 9.12358L9.54261 0.28125L10.956 1.6875L2.07102 10.5369ZM9.54261 10.5369L0.657671 1.6875L2.07102 0.28125L10.9489 9.12358L9.54261 10.5369Z" fill="#303840"/></svg></div></div><div class="askunali-question-output-container" style="background-color:#fff;border:none;border-bottom:none;border-radius:4px 4px 0 0;margin-top:calc(var(--spacing-base) * 1.5);min-height:calc(1rem * 6);padding:var(--spacing-base) calc(var(--spacing-base) * 1.2);padding-left:55px;padding-top:0;position:relative"><svg id="askunali-question-output-icon" width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" style="height:32px;left:10.5px;position:absolute;top:30px;transform:translateY(-50%);width:32px"><circle cx="16" cy="16" r="11.2" fill="white"/><circle cx="16" cy="16" r="9.6" fill="#233550"/><g class="outer-donut-1"><g><path d="M 16,1.6 A 14.4,14.4 0 0 1 30.4,16 L 27.2,16 A 11.2,11.2 0 0 0 16,4.8 Z" fill="#233550"/></g></g><g class="outer-donut-2"><g><path d="M 30.4,16 A 14.4,14.4 0 0 1 16,30.4 L 16,27.2 A 11.2,11.2 0 0 0 27.2,16 Z" fill="#233550"/></g></g><g class="outer-donut-3"><g><path d="M 16,30.4 A 14.4,14.4 0 0 1 1.6,16 L 4.8,16 A 11.2,11.2 0 0 0 16,27.2 Z" fill="#233550"/></g></g><g class="outer-donut-4"><g><path d="M 1.6,16 A 14.4,14.4 0 0 1 16,1.6 L 16,4.8 A 11.2,11.2 0 0 0 4.8,16 Z" fill="#233550"/></g></g></svg><div id="askunali-question-suggestions-container" style="display:flex;flex-wrap:wrap;gap:15px;justify-content:left"></div><div id="askunali-answer" style="font-size:15px;line-height:22px;padding-top:20px"></div><div id="askunali-shopping-container" style="align-items:center;display:none;flex-wrap:wrap;margin-top:calc(var(--spacing-base) * 1.5)"><svg id="askunali-shopping-cart" width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.9"><path d="M4.25 9.03125H8.5L11.6875 21.25H25.5L28.6875 11.1562H13.2812" stroke="#47505A" stroke-width="2" stroke-linecap="round"/><circle cx="22.8854" cy="25.5001" r="1.96154" fill="#47505A"/><circle cx="22.8854" cy="25.5001" r="1.96154" fill="#47505A"/><circle cx="22.8854" cy="25.5001" r="1.96154" fill="#47505A"/><circle cx="13.7311" cy="25.5001" r="1.96154" fill="#47505A"/><circle cx="13.7311" cy="25.5001" r="1.96154" fill="#47505A"/><circle cx="13.7311" cy="25.5001" r="1.96154" fill="#47505A"/></g></svg> <span id="askunali-shopping-cart-description" style="color:#303840;font-size:15px;margin-left:10px;margin-right:5px;opacity:90%">related</span> <svg id="askunali-shopping-cart-separator" width="3" height="10" viewBox="0 0 3 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path opacity="0.9" d="M1.26136 9.10795C0.950758 9.10795 0.683712 8.99811 0.460227 8.77841C0.236742 8.55492 0.125 8.28598 0.125 7.97159C0.125 7.66098 0.236742 7.39583 0.460227 7.17614C0.683712 6.95265 0.950758 6.84091 1.26136 6.84091C1.57197 6.84091 1.83902 6.95265 2.0625 7.17614C2.28598 7.39583 2.39773 7.66098 2.39773 7.97159C2.39773 8.17992 2.3447 8.37121 2.23864 8.54545C2.13636 8.71591 2 8.85227 1.82955 8.95455C1.65909 9.05682 1.4697 9.10795 1.26136 9.10795ZM1.26136 2.75568C0.950758 2.75568 0.683712 2.64394 0.460227 2.42045C0.236742 2.19697 0.125 1.92992 0.125 1.61932C0.125 1.30871 0.236742 1.04356 0.460227 0.823863C0.683712 0.600378 0.950758 0.488636 1.26136 0.488636C1.57197 0.488636 1.83902 0.600378 2.0625 0.823863C2.28598 1.04356 2.39773 1.30871 2.39773 1.61932C2.39773 1.82765 2.3447 2.01894 2.23864 2.19318C2.13636 2.36364 2 2.5 1.82955 2.60227C1.65909 2.70455 1.4697 2.75568 1.26136 2.75568Z" fill="#59626B"/></svg><div id="askunali-shopping-links" style="display:flex;margin-left:15px"></div></div><button id="askunali-return-button" style="align-items:center;background:#fbfbff;border:.5px solid #d5e1ea;border-radius:4px;cursor:pointer;display:none;height:42px;justify-content:center;margin-top:20px;opacity:90%;width:100px">&lt; Return</button></div><div class="askunali-question-output-container-bottom" style="background-color:#fff;border:none;border-radius:0 0 4px 4px;border-top:none;height:auto;padding-bottom:0;padding-left:55px;padding-right:calc(var(--spacing-base) * 1.2);padding-top:0;position:relative"><div id="askunali-separator" style="display:none"></div><div id="askunali-bottom-container" style="align-items:baseline;display:flex;justify-content:space-between"><div id="askunali-sources" style="align-items:center;display:none;font-size:var(--font-size-sources);margin:15px 0;opacity:90%"></div><div id="askunali-link" style="display:none"><a href="https://askunali.com" target="_blank" style="color:var(--color-secondary);font-size:var(--font-size-sources);opacity:90%;text-decoration:underline">Askunali.com</a></div></div></div></div></div>',initWidget(),loadAnimationStyles(),window.askUnaliUpdateApiKey=function(e){updateApiKey(e)},window.askUnaliResetWidget=function(){resetWidget()})}init();